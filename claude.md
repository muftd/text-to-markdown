# **开发指南（Development Guidelines）**

## **理念（Philosophy）**

### **核心信念（Core Beliefs）**

* **循序渐进优于一次性大爆炸**

  * 小步快跑，每次提交都能编译通过并通过测试

* **从现有代码中学习**

  * 在写代码前先阅读、研究、规划

* **实用主义优于教条主义**

  * 根据项目实际情况调整做法，而不是死守规则

* **清晰意图优于聪明代码**

  * 让代码“无聊且显而易见”

### **简洁意味着什么（Simplicity Means）**

* 每个函数/类只承担单一职责
* 避免过早抽象
* 不做技术花活 — 选择最无聊但可维护的方案
* 如果需要特别解释，说明这段设计太复杂了

### **权限管理（Permission Management）**

除了 **删除文件** 与 **数据库操作** 以外，其余所有操作都不需要经过我的确认。

---

## **流程（Process）**

### **1. 规划与分阶段（Planning & Staging）**

将复杂任务拆成 **3–5 个阶段**，并记录在 `IMPLEMENTATION_PLAN.md`：

```markdown
## Stage N: [名称]

**Goal**: [该阶段的具体产出]
**Success Criteria**: [可检测的成功标准]
**Tests**: [该阶段的测试用例]
**Status**: [Not Started | In Progress | Complete]
```

* 随开发进展更新状态
* 所有阶段完成后删除此文件

---

### **2. 实现流程（Implementation Flow）**

1. **Understand（理解）** — 先阅读代码库中已有的模式
2. **Test（测试）** — 先写失败的测试（red）
3. **Implement（实现）** — 写最少量代码让测试通过（green）
4. **Refactor（重构）** — 在测试通过的情况下清理代码
5. **Commit（提交）** — 使用明确、关联计划的提交信息

---

### **3. 遇到阻塞（最多尝试 3 次）（When Stuck — After 3 Attempts）**

**关键规则：任何问题最多尝试 3 次，然后立即停止。**

1. **记录失败原因**：

   * 你尝试了什么？
   * 具体报错是什么？
   * 你认为失败的原因？

2. **调研替代方案**：

   * 找到 2–3 个类似实现
   * 记录它们采用的不同方法

3. **质疑基本假设**：

   * 抽象层级是否正确？
   * 能否拆成更小的问题？
   * 是否存在更简单的方案？

4. **换个角度尝试**：

   * 换一个库/框架的特性？
   * 换一种架构模式？
   * 去掉抽象而不是继续加？

---

## **技术标准（Technical Standards）**

### **架构原则（Architecture Principles）**

* **组合优于继承**

  * 使用依赖注入（DI）

* **接口优于单例**

  * 提高测试性与灵活度

* **显式优于隐式**

  * 数据流、依赖要清晰暴露

* **尽可能 TDD（测试驱动）**

  * 永远不要禁用测试，坏测试要修而不是关

---

### **代码质量（Code Quality）**

**每次提交必须满足：**

* 能成功编译
* 所有现有测试通过
* 为新增功能补充测试
* 符合项目格式化/lint 配置

**提交前应完成：**

* 运行 formatter / linter
* 自我检查变更
* 提交信息说明“为什么”，而不仅是“改了什么”

---

### **错误处理（Error Handling）**

* 尽早失败，且提供可理解的错误信息
* 错误信息中包含必要调试上下文
* 在合适的层级捕获错误
* 永远不要静默吞掉异常

---

## **决策框架（Decision Framework）**

当存在多个可行方案时，从以下维度进行选择：

1. **可测试性** — 是否容易写测试？
2. **可读性** — 6 个月后别人能读懂吗？
3. **一致性** — 是否符合现有项目模式？
4. **简洁性** — 这是能工作且最简单的方案吗？
5. **可逆性** — 将来修改成本高吗？

---

## **项目集成（Project Integration）**

### **学习现有代码库（Learning the Codebase）**

* 找到 3 个类似的功能/组件
* 找出它们的公共模式与约定
* 尽量复用同样的工具库
* 使用现有的测试模式与工具

---

### **工具链（Tooling）**

* 使用项目已有的构建系统
* 使用项目统一的测试框架
* 使用项目标准的 formatter / linter
* 如果没有充分理由，不要增加新工具

---

## **质量门槛（Quality Gates）**

### **完成定义（Definition of Done）**

* [ ] 测试已编写并通过
* [ ] 代码符合项目规范
* [ ] 无 lint/format 警告
* [ ] 提交信息清晰
* [ ] 实现与计划一致
* [ ] 无未解决的 TODO（除非有 issue 编号）

---

### **测试指南（Test Guidelines）**

* 测试行为，而不是具体实现
* 能做到时，每个测试只包含一个断言
* 测试名称应清楚描述场景
* 使用已有的测试工具与辅助函数
* 测试必须具有确定性（deterministic）

---

## **重要提醒（Important Reminders）**

**绝对不要：**

* 使用 `--no-verify` 绕过 commit hooks
* 关闭或跳过测试
* 提交无法编译的代码
* 想当然做判断 — 必须阅读现有代码验证

**必须始终做到：**

* 小步提交、每次都提交可运行的代码
* 随开发更新计划文档
* 从已有实现中学习
* 遇到 3 次失败必须停止并重评
* 当需要代码生成、环境配置、库/API 文档查询时 **始终使用 Context7**
  * 你应自动调用 Context7 MCP 工具解析库 ID 并获取文档，而无需我重复要求